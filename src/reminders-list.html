<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-list/iron-list.html">
<link rel="import" href="reminders-item.html">

<dom-module id="reminders-list">

    <template>
        <style>
            :host {
                @apply(--paper-font-common-base);
                display: block;
                height: 100vh;
            }

            iron-list {
                --iron-list-items-container: {
                    margin-top: 60px;
                    margin-bottom: 60px;
                    border-bottom: 1px solid #ddd;
                };
            }

            .col-half {
                float: left;
                width: 50%;
            }

            .full-width {
                clear: both;
                width: 100%;
            }

            .buttons-grp {
                margin: 50px 0 30px 25px;
            }

            paper-input,
            paper-textarea {
                margin: 30px;
            }
        </style>

        <iron-ajax url="data/reminders.json" last-response="{{items}}" auto></iron-ajax>

        <iron-list id="list" items="[[items]]" as="item">
            <template>
                <reminders-item title="[[item.title]]" date="[[item.date]]" description="[[item.description]]" done="{{item.done}}" hash="{{item.hash}}"></reminders-item>
            </template>
        </iron-list>

        <form is="iron-form" method="get" action="/">
            <div class="col-half">
                <paper-input name="title" label="Title" value="{{item.title}}" required></paper-input>
            </div>
            <div class="col-half">
                <paper-input label="Due Date" type="date" value="{{item.date}}" placeholder="Due Date"></paper-input>
            </div>
            <div class="full-width">
                <paper-textarea label="Description" value="{{item.description}}"></paper-textarea>
            </div>
            <div class="buttons-grp full-width">
                <paper-button raised on-tap="_addReminder">Add Reminder</paper-button>
                <paper-button raised on-tap="_cleanReminder">Clean Reminder</paper-button>
            </div>
        </form>
    </template>

    <script>
        Polymer( {
            is: 'reminders-list',

            properties: {
                items: {
                    type: Array,
                    value: [],
                },
                item: {
                    type: Object,
                    value: {},
                },
            },

            ready: function() {
                this.addEventListener( 'removeReminder', function( e ) {
                    var itemIndex = this.items.findIndex( function( item ) {
                        return item.hash === e.detail.hash;
                    } );

                    this.splice( 'items', itemIndex, 1 );
                    this.$.list.notifyResize();
                } );
            },

            _uniqHash: function() {
                var text = '';
                var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
                    + 'abcdefghijklmnopqrstuvwxyz'
                    + '0123456789';

                for( var i=0; i < 5; i++ ) {
                    text += possible.charAt(
                        Math.floor( Math.random() * possible.length )
                    );
                }

                return text;
            },

            _addReminder: function() {
                if ( typeof this.item.title !== 'undefined' && this.item.title ) {
                    // create hash to identify the reminder
                    this.hash = this._uniqHash();

                    this.push( 'items', this.item );
                    this.item = {};
                }
            },

            _cleanReminder: function() {
                this.item = {};
            },
        } );
    </script>

</dom-module>
